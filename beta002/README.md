**v.0.0.2b(202503212100)**

# HydraRoute

**Маршрутизация доменов** - выбрать куда перенаправить отдельные домены или группу/список доменов можно
просто изменив подключение в политике доступа веб-интерфейса роутера.

## Установка:
1. Подключитесь к роутеру по SSH (к Entware, строго под root), обновите пакеты и установите curl.
	```
	opkg update && opkg install curl
	```
2. Установите **HydraRoute** версию **0.0.2b**
	```
	curl -Ls "https://github.com/Ground-Zerro/HydraRoute/raw/refs/heads/main/beta002/hydra.sh" | sh
	```
3. После перезагрузки роутера:
    - в веб-панели роутера перейдите:
      * Приоритеты подключений -> Политики доступа в интернет
      * в политике **HydraRoute1st** отметьте галочкой нужный VPN или другое подключение

## Как добавить домены
1. Через web-панель.
   - web-панель доступна по адресу: [http://hr.net/](http://hr.net/) или [http://192.168.1.1:2000/](http://192.168.1.1:2000/)
     * (где `192.168.1.1` - это IP-адрес роутера)
	 - пароль по умолчанию "keenetic"

2. Вручную, правкой файла `domain.conf`.

    <details>
    <summary>нажать, чтобы прочесть подробней</summary>

	1. Чтобы добавить домены для перенаправления, отредактируйте файл: `/opt/etc/AdGuardHome/domain.conf`:
		```
		nano /opt/etc/AdGuardHome/domain.conf
		```

		Пример `domain.conf`:
		```
		youtube.com,googlevideo.com/hr1
		openai.com,chatgpt.com/hr2
		```

		* В левой части через запятую указаны домены
		* В паровой после слэш - `ipset` политики, которой они управляются

		   |  имя политики   |  ipset  |
		   |:---------------:|:-------:|
		   |  HydraRoute1st  |   hr1   |
		   |  HydraRoute2nd  |   hr2   |
		   |  HydraRoute3rd  |   hr3   |

	2. После добавления доменов необходимо перезапустить **AdGuard Home** командой:
		```
		agh restart
		```
		Домены третьего уровня и выше указывать не нужно, они подхватываются автоматически.
		* **Пример**: указав `google.com` будут перенаправляться все домены, заканивающиеся на `google.com`, в т.ч. `mail.google.com`, `drive.google.com` и т.д.

	</details>

## Удаление:
```
curl -Ls "https://raw.githubusercontent.com/Ground-Zerro/HydraRoute/refs/heads/main/uninstall.sh" | sh
```

## Информация:
- приоритеты подключений работают! Можно установить порядок в котором будут последовательно переключаться туннели
если у вышестоящего пропадёт связь.
- если в политике снять все галочки с подключений - домены будут заблокированы.
- изменения в политике применяются практически мгновенно, ничего перезагружать, включать или переподключать не нужно.
- в политику можно добавлять устройства. **Весь** их трафик в этом случае пойдет через указанное в политике подключение.
- WARP - работает.

## ВАЖНО:
**Не пытайтесь переименовать или удалить политики**
- роутер самостоятельно перезагрузится, политики и их имена будут восстановлены.
